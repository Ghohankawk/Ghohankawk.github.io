<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 关于log4j的使用说明 · 闻道</title><meta name="description" content="关于log4j的使用说明 - 韩坤"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9654808400771776",
    enable_page_level_ads: true
});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject'] = r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-100775956-1', 'auto');
ga('send', 'pageview');
</script><link rel="search" type="application/opensearchdescription+xml" href="http://ghohankawk.github.io/atom.xml" title="闻道"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">闻道</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives/" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about.html" target="_self" class="li component-nav-item"><p>关于我</p></a><a href="/test.html" target="_self" class="li component-nav-item"><p>测试页</p></a><ul class="shortcut-icons"><a href="http://blog.csdn.net/ghohankawk" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">关于log4j的使用说明</h1><div class="post-info">Jun 6, 2017</div><div class="post-content"><h1 id="今天要分享的内容是log4j的使用。"><a href="#今天要分享的内容是log4j的使用。" class="headerlink" title="今天要分享的内容是log4j的使用。"></a>今天要分享的内容是log4j的使用。</h1><p>每个系统都有日志记录，而多数都是用的log4j，以为会配置了，懂了，发现还是有些细节的问题，要问，说不上来</p>
<h1 id="先来直接看配置吧和测试用例吧"><a href="#先来直接看配置吧和测试用例吧" class="headerlink" title="先来直接看配置吧和测试用例吧"></a>先来直接看配置吧和测试用例吧</h1><p>jar包的依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- log4j support --&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;1.2.17&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>log4j.properties文件如下，放在你的web的resource下面，推荐maven标准工程来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">### 设置###</div><div class="line">log4j.rootLogger = DEBUG,stdout,D,E</div><div class="line"></div><div class="line">log4j.logger.A=DEBUG, stdout</div><div class="line">log4j.logger.A.B=INFO, stdout  </div><div class="line"></div><div class="line">### 输出信息到控制抬 ###</div><div class="line">log4j.appender.stdout = org.apache.log4j.ConsoleAppender</div><div class="line">log4j.appender.stdout.Target = System.out</div><div class="line">log4j.appender.stdout.layout = org.apache.log4j.PatternLayout</div><div class="line">log4j.appender.stdout.layout.ConversionPattern = [%-5p] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; method:%l%n%m%n</div><div class="line"></div><div class="line">### 输出DEBUG 级别以上的日志到=D://logs/error.log ###</div><div class="line">log4j.appender.D = org.apache.log4j.DailyRollingFileAppender</div><div class="line">log4j.appender.D.File = D://logs/log.log</div><div class="line">log4j.appender.D.Append = true</div><div class="line">log4j.appender.D.Threshold = DEBUG</div><div class="line">log4j.appender.D.layout = org.apache.log4j.PatternLayout</div><div class="line">log4j.appender.D.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %m%n</div><div class="line"></div><div class="line">### 输出ERROR 级别以上的日志到=D://logs/error.log ###</div><div class="line">log4j.appender.E = org.apache.log4j.DailyRollingFileAppender</div><div class="line">log4j.appender.E.File =D://logs/error.log</div><div class="line">log4j.appender.E.Append = true</div><div class="line">log4j.appender.E.Threshold = ERROR</div><div class="line">log4j.appender.E.layout = org.apache.log4j.PatternLayout</div><div class="line">log4j.appender.E.layout.ConversionPattern = %-d&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %m%n</div></pre></td></tr></table></figure></p>
<p>测试用例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import org.apache.log4j.Logger;</div><div class="line"></div><div class="line">/**</div><div class="line"> * @author hankun</div><div class="line"> * @create 2017-06-06 18:32</div><div class="line"> */</div><div class="line">public class log4jTtest &#123;</div><div class="line">    private static Logger logger = Logger.getLogger(log4jTtest.class);</div><div class="line">    private static Logger loggerA = Logger.getLogger(&quot;A&quot;);</div><div class="line">    private static Logger loggerA_B = Logger.getLogger(&quot;A.B&quot;);</div><div class="line"></div><div class="line">    /**</div><div class="line">     * @param args</div><div class="line">     */</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line"></div><div class="line">        // 记录debug级别的信息</div><div class="line">        logger.debug(&quot;This is debug message.&quot;);</div><div class="line">        // 记录info级别的信息</div><div class="line">        logger.info(&quot;This is info message.&quot;);</div><div class="line">        // 记录error级别的信息</div><div class="line">        logger.error(&quot;This is error message.&quot;);</div><div class="line"></div><div class="line">        loggerA_B.info(&quot;repeat three times in console&quot;);</div><div class="line">        loggerA.info(&quot;repeat two times in console&quot;);</div><div class="line">        logger.info(&quot;repeat one times in console&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="注意上面的输出结果，你知道输出啥内容，则，就真正理解了"><a href="#注意上面的输出结果，你知道输出啥内容，则，就真正理解了" class="headerlink" title="注意上面的输出结果，你知道输出啥内容，则，就真正理解了"></a>注意上面的输出结果，你知道输出啥内容，则，就真正理解了</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[DEBUG] 2017-06-06 19:05:03,477 method:log4jTtest.main(log4jTtest.java:18)</div><div class="line">This is debug message.</div><div class="line">[INFO ] 2017-06-06 19:05:03,479 method:log4jTtest.main(log4jTtest.java:20)</div><div class="line">This is info message.</div><div class="line">[ERROR] 2017-06-06 19:05:03,479 method:log4jTtest.main(log4jTtest.java:22)</div><div class="line">This is error message.</div><div class="line">[INFO ] 2017-06-06 19:05:03,479 method:log4jTtest.main(log4jTtest.java:24)</div><div class="line">repeat three times in console</div><div class="line">[INFO ] 2017-06-06 19:05:03,479 method:log4jTtest.main(log4jTtest.java:24)</div><div class="line">repeat three times in console</div><div class="line">[INFO ] 2017-06-06 19:05:03,479 method:log4jTtest.main(log4jTtest.java:24)</div><div class="line">repeat three times in console</div><div class="line">[INFO ] 2017-06-06 19:05:03,480 method:log4jTtest.main(log4jTtest.java:25)</div><div class="line">repeat two times in console</div><div class="line">[INFO ] 2017-06-06 19:05:03,480 method:log4jTtest.main(log4jTtest.java:25)</div><div class="line">repeat two times in console</div><div class="line">[INFO ] 2017-06-06 19:05:03,480 method:log4jTtest.main(log4jTtest.java:26)</div><div class="line">repeat one times in console</div></pre></td></tr></table></figure>
<h1 id="问题如下"><a href="#问题如下" class="headerlink" title="问题如下"></a>问题如下</h1><ol>
<li>前面的三个输出，不用解释，都明白为啥</li>
<li>为啥那个loggerA_B，输出了三次，而loggerA输出了二次，logger输出了一次？</li>
</ol>
<h1 id="log4j几个重要的概念"><a href="#log4j几个重要的概念" class="headerlink" title="log4j几个重要的概念"></a>log4j几个重要的概念</h1><ul>
<li>logger组件<ol>
<li>简单的说，它就是决定了应用程序中，哪些代码哪些地方，有可能输出日志</li>
<li>这也就是为什么，每个类里面上来，就是，logger的初始化，它决定了这个类有资格输出日志</li>
<li>首先Log4J中总是存在一个rootLogger，即使没有显示配置也是存在的，并且默认输出级别为DEBUG。</li>
<li>Log4J中的层次是用’.’来分隔的，如log4j.logger.com.example.test，这里并不是说log4j.logger后面一定是具体的包名乃至类名，</li>
</ol>
</li>
<li>appender组件<ol>
<li>输出地，也就是你的日志想输出到哪里，把上面的logger里面的日志</li>
<li>再简单点，就是输出到控制台和文件里面，也就是上面的配置stdout和D和E</li>
<li>这个需要和下面的这个概念配合</li>
</ol>
</li>
<li>输出控制的概念<ol>
<li>Log4j默认把日志信息分为五个等级  all&lt;debug &lt; info &lt; warn &lt; error &lt; fatal&lt;off</li>
<li>只有大于设置的级别，才会打印日志，低于则忽略</li>
<li>log4j.appender.threshold=ERROR，这种配置用于控制，一个appender的输出级别</li>
</ol>
</li>
<li>继承的概念<ol>
<li>log4j.rootLogger=DEBUG, Console</li>
<li>log4j.logger.A=DEBUG, Console</li>
<li>log4j.logger.A.B=INFO, Console</li>
<li>A.B继承A，再继承最顶级的root</li>
<li>Log4j是根据Log的名字来判断继承关系的</li>
</ol>
</li>
</ul>
<h1 id="来解释一下，上面的输出结果"><a href="#来解释一下，上面的输出结果" class="headerlink" title="来解释一下，上面的输出结果"></a>来解释一下，上面的输出结果</h1><ol>
<li>首先是，debug，info和error前三个日志输出，它们的logger是log4jTtest.class初始化的，继承根logger，因此就是debug级别，同时因为还有D和E的两个appender，所以你在d盘可以看到，有一个info的文件还有一个error的文件，这个日志输出没问题</li>
<li>然后就是解释那重复的三个，因为loggerA_B，它是根据A.B这个参数初始化的，是有继承的，满足A.B的info级别的日志输出，必然满足A的logger的日志输出，当然还有默认的根输出，因此三次</li>
<li>而那个两次的，它的logger是loggerA，继承于根，因此，info的时候，它本身输出一次，根也输出一次，就是两次了。</li>
<li>最后一个，用的是默认的根，当然，只能输出一次了</li>
</ol>
<h1 id="问题来了，怎么避免重复，因为继承父的logger？"><a href="#问题来了，怎么避免重复，因为继承父的logger？" class="headerlink" title="问题来了，怎么避免重复，因为继承父的logger？"></a>问题来了，怎么避免重复，因为继承父的logger？</h1><pre><code>log4j.additivity.A.B=false
logger A.B的日志仅会输出到自己Console中，不会继承任何父logger的appender。
</code></pre><p> 就加上面的这句，就解决了问题</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>之前反反复复看了很多次，关于日志log4j的配置，每次看完以为会了，但是到了项目里面，总是不知道，自己有时候打印的日志到底跑哪里去了，或者去哪里看？<br>总结其原因就是，对于细节没有掌握理解到位，比如就是这个logger的概念，如果你真正的明白了，就知道了</p>
<p>谁能产生日志？logger</p>
<p>日志放哪里？appender</p>
<p>什么级别的日志才会输出？日志级别</p>
<p>他们是相互独立的组件，单独配置，又是相互配合，一起使用的，n*m的这种概念</p>
<p>因此上面的配置文件，一个logger可以对应多个appender，而appender之间又是彼此独立的。</p>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/2017/06/06/before-gaokao/" class="prev">上一篇</a><a href="/2017/06/02/liuyi/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 <a href="http://ghohankawk.github.io">韩坤</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer></body></html>