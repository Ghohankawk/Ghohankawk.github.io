<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 关于hive中decode函数，默认转码没有GBK中文字符集的问题 · 闻道</title><meta name="description" content="关于hive中decode函数，默认转码没有GBK中文字符集的问题 - 韩坤"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9654808400771776",
    enable_page_level_ads: true
});

</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject'] = r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-100775956-1', 'auto');
ga('send', 'pageview');
</script><link rel="search" type="application/opensearchdescription+xml" href="http://ghohankawk.github.io/atom.xml" title="闻道"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">闻道</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives/" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about.html" target="_self" class="li component-nav-item"><p>关于我</p></a><ul class="shortcut-icons"><a href="http://blog.csdn.net/ghohankawk" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">关于hive中decode函数，默认转码没有GBK中文字符集的问题</h1><div class="post-info">Jul 21, 2017</div><div class="post-content"><p>今天要分享的内容是hive的select查询中的decode函数，对url进行转码的查询，看了官方文档，心都凉了，如下<br>string<br><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF" target="_blank" rel="external">decode(binary bin, string charset)</a><br>Decodes the first argument into a String using the provided character set (one of ‘US-ASCII’, ‘ISO-8859-1’, ‘UTF-8’, ‘UTF-16BE’, ‘UTF-16LE’, ‘UTF-16’). If either argument is null, the result will also be null. (As of Hive 0.12.0.)<br><a id="more"></a> </p>
<h1 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h1><p>上面的那句话，就是说，默认的编码类型，只能从中的一个字符类型，其他不在范围内的肯定识别不了    </p>
<h1 id="比如说，-cb-d1-b9-b7"><a href="#比如说，-cb-d1-b9-b7" class="headerlink" title="比如说，%cb%d1%b9%b7"></a>比如说，%cb%d1%b9%b7</h1><p>上面的这个转码以后是，搜狗</p>
<p>前提必须是，用gbk，gb1312，gb18030随便一个字符集就可以了，他们的三个区别，<br>基本就是gb1312&lt;gbk&lt;gb18030,就是说，一个包含的字符集比一个多，也就是更全</p>
<p>如果你用java的utf-8解码，肯定是乱码中文</p>
<p>如果你用js的decodeURI()的这个方法，会报错，因为他不是utf-8的转码</p>
<h1 id="搜狗的utf-8的编码是多少？"><a href="#搜狗的utf-8的编码是多少？" class="headerlink" title="搜狗的utf-8的编码是多少？"></a>搜狗的utf-8的编码是多少？</h1><pre><code>%e6%90%9c%e7%8b%97
</code></pre><p>因此，你无论用java的urldecoder的decode方法，或者<br>js中的decodeURI(“%e6%90%9c%e7%8b%97”)方法，都是能得到正确的编码的</p>
<h1 id="那在hive中怎么办？"><a href="#那在hive中怎么办？" class="headerlink" title="那在hive中怎么办？"></a>那在hive中怎么办？</h1><p>关于怎么办这个地方，真是被坑了好久了</p>
<ol>
<li>资料少，根本搜不到</li>
<li>你也不会搜，也就是不会提问，当然搜不到</li>
<li><p>总之，就是找不到答案</p>
<h1 id="答案就是，另外的一个内建函数reflect"><a href="#答案就是，另外的一个内建函数reflect" class="headerlink" title="答案就是，另外的一个内建函数reflect"></a>答案就是，另外的一个内建函数reflect</h1><p> select  reflect(‘java.net.URLDecoder’, ‘decode’,’%cb%d1%b9%b7’ , “GBK”) from tmp_table  </p>
</li>
</ol>
<p>光看名字，就会让你想到，java中的反射，果不其然，这次就到了，你熟悉的地方了</p>
<p>因为网上的例子太少了，就连写出上面的查询，都是各种坑啊</p>
<h1 id="最后一个无关的问题，charset-forName-或者，decode函数，字符集区分大小写吗？"><a href="#最后一个无关的问题，charset-forName-或者，decode函数，字符集区分大小写吗？" class="headerlink" title="最后一个无关的问题，charset.forName(),或者，decode函数，字符集区分大小写吗？"></a>最后一个无关的问题，charset.forName(),或者，decode函数，字符集区分大小写吗？</h1><p>不区分，官方文档里面说了</p>
<h1 id="如何做到不区分的？Charset-gg-Charset-forName-“gg”-为什么识别是错的？"><a href="#如何做到不区分的？Charset-gg-Charset-forName-“gg”-为什么识别是错的？" class="headerlink" title="如何做到不区分的？Charset gg = Charset.forName(“gg”);为什么识别是错的？"></a>如何做到不区分的？Charset gg = Charset.forName(“gg”);为什么识别是错的？</h1><p>这个本来和hive是无关的，最开始运行的时候报错了，以为是这个地方的问题</p>
<p>最后最终调试了一下代码，总算是知道，为啥可以做到忽略大小写的问题，里面有一个很关键的排序比较器</p>
<p>网上的资源，太少了，根本没有一个讲这个部分的原理，看了半天硬是没有看明白</p>
<p>最终在不限的努力，找到了一个关键类</p>
<p>ASCIICaseInsensitiveComparator</p>
<p>就是他，起到了忽略大小写的关键原因，可以用ide反向最终一下，一看就明白</p>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/2017/07/21/originTemplate/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 <a href="http://ghohankawk.github.io">韩坤</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer></body></html>